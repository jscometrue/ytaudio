<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#0f0f0f" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="description" content="ìœ íŠœë¸Œ ë°±ê·¸ë¼ìš´ë“œ ì˜¤ë””ì˜¤ - í™”ë©´ êº¼ì§„ ìƒíƒœì—ì„œ ìŒì„±ë§Œ ì¬ìƒ" />
  <title>YouTube ë°±ê·¸ë¼ìš´ë“œ ì˜¤ë””ì˜¤</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    :root {
      --bg: #0f0f0f;
      --surface: #1a1a1a;
      --accent: #ff0000;
      --accent-dim: #cc0000;
      --text: #f1f1f1;
      --text-dim: #888;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
      overflow: hidden;
    }
    .app {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-width: 480px;
      margin: 0 auto;
    }
    header {
      padding: 12px 16px;
      background: var(--surface);
      border-bottom: 1px solid rgba(255,255,255,.06);
      flex-shrink: 0;
    }
    h1 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
    }
    .input-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    input[type="text"] {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
      outline: none;
    }
    input[type="text"]::placeholder { color: var(--text-dim); }
    input[type="text"]:focus { border-color: var(--accent); }
    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background .15s;
    }
    .btn-primary {
      background: var(--accent);
      color: #fff;
    }
    .btn-primary:hover { background: var(--accent-dim); }
    .btn-primary:disabled { opacity: .5; cursor: not-allowed; }
    .player-zone {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      min-height: 0;
    }
    /* YouTube ìµœì†Œ ë·°í¬íŠ¸ 200x200 - í™”ë©´ ë°–ì— ë°°ì¹˜í•˜ì—¬ ì˜¤ë””ì˜¤ë§Œ ì‚¬ìš© */
    #yt-container {
      position: fixed;
      left: -210px;
      top: 0;
      width: 200px;
      height: 200px;
      opacity: 0;
      pointer-events: none;
      z-index: -1;
    }
    .now-playing {
      width: 100%;
      padding: 16px;
      background: var(--surface);
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
    }
    .now-playing .title {
      font-size: 1rem;
      font-weight: 500;
      margin: 0 0 4px 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .now-playing .id { font-size: 12px; color: var(--text-dim); margin: 0; }
    .controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    .ctrl-btn {
      width: 48px;
      height: 48px;
      border: none;
      border-radius: 50%;
      background: var(--surface);
      color: var(--text);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background .15s, transform .1s;
    }
    .ctrl-btn:active { transform: scale(0.95); }
    .ctrl-btn.play-pause {
      width: 64px;
      height: 64px;
      font-size: 28px;
      background: var(--accent);
      color: #fff;
    }
    .progress-wrap {
      width: 100%;
      padding: 0 8px;
      margin-bottom: 12px;
    }
    .progress-bar {
      height: 6px;
      background: rgba(255,255,255,.15);
      border-radius: 3px;
      overflow: hidden;
      cursor: pointer;
    }
    .progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 3px;
      width: 0%;
      transition: width .2s;
    }
    .time-labels {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--text-dim);
      margin-top: 4px;
    }
    .volume-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      max-width: 200px;
    }
    .volume-wrap input[type="range"] {
      flex: 1;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(255,255,255,.15);
      border-radius: 3px;
      outline: none;
    }
    .volume-wrap input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
    }
    .hint {
      margin-top: 24px;
      font-size: 12px;
      color: var(--text-dim);
      text-align: center;
      padding: 0 16px;
    }
    .hint a { color: var(--accent); }
    .mobile-card {
      width: 100%;
      max-width: 320px;
      margin: 16px auto 0;
      padding: 16px;
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.08);
      text-align: center;
    }
    .mobile-card h3 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }
    .mobile-card p {
      margin: 0 0 12px 0;
      font-size: 12px;
      color: var(--text-dim);
    }
    .mobile-card .mobile-url {
      font-size: 13px;
      word-break: break-all;
      color: var(--accent);
      margin-bottom: 12px;
      padding: 8px;
      background: rgba(255,0,0,.1);
      border-radius: 8px;
    }
    .mobile-card .qr-wrap {
      margin-top: 12px;
    }
    .mobile-card .qr-wrap img {
      display: block;
      margin: 0 auto;
      border-radius: 8px;
      max-width: 160px;
      height: auto;
    }
    @media (max-width: 480px) {
      .mobile-card { display: none !important; }
    }
    .search-row { display: flex; gap: 8px; margin-top: 8px; align-items: center; }
    .search-row input { flex: 1; }
    .search-results {
      width: 100%;
      max-height: 280px;
      overflow-y: auto;
      margin-top: 12px;
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.08);
    }
    .search-results:empty { display: none; }
    .search-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      cursor: pointer;
      transition: background .15s;
      text-align: left;
    }
    .search-item:last-child { border-bottom: none; }
    .search-item:hover, .search-item:active { background: rgba(255,255,255,.06); }
    .search-item img {
      width: 120px;
      height: 68px;
      object-fit: cover;
      border-radius: 6px;
      flex-shrink: 0;
    }
    .search-item .info { flex: 1; min-width: 0; }
    .search-item .info .stitle {
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .search-item .info .channel { font-size: 11px; color: var(--text-dim); margin-top: 2px; }
    .search-item .info .date { font-size: 1.15rem; font-weight: 700; color: var(--accent); margin-top: 6px; display: block; }
    @media (max-width: 480px) {
      .search-item .info .date { font-size: 1.25rem; }
    }
    .header-top { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .header-top h1 { flex: 1; }
    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border: none;
      border-radius: 50%;
      background: transparent;
      color: var(--text-dim);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .btn-icon:hover { color: var(--text); background: rgba(255,255,255,.08); }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
    }
    .modal-overlay.hidden { display: none; }
    .modal {
      background: var(--surface);
      border-radius: 16px;
      padding: 20px;
      max-width: 360px;
      width: 100%;
      border: 1px solid rgba(255,255,255,.1);
    }
    .modal h3 { margin: 0 0 12px 0; font-size: 16px; }
    .modal p { font-size: 12px; color: var(--text-dim); margin: 0 0 12px 0; }
    .modal input { width: 100%; margin-bottom: 12px; }
    .modal .btns { display: flex; gap: 8px; justify-content: flex-end; }
    .install-banner {
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 14px;
      background: var(--surface);
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-size: 13px;
    }
    .install-banner.show { display: flex; }
    .install-banner .install-btn { flex-shrink: 0; padding: 8px 14px; font-size: 13px; }
    .search-loading, .search-error { padding: 12px; font-size: 13px; color: var(--text-dim); text-align: center; }
    .search-error { color: #f44; }
    .api-key-hint { margin: 6px 0 0 0; font-size: 12px; }
    .link-btn { background: none; border: none; color: var(--accent); text-decoration: underline; cursor: pointer; padding: 0; font-size: 12px; }
    .link-btn:hover { color: var(--accent-dim); }
    .modal-hint { background: rgba(255,0,0,.12); color: var(--text); padding: 8px 10px; border-radius: 8px; font-size: 13px; margin-bottom: 10px; }
    .modal-hint.hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="app">
    <div class="install-banner" id="installBanner">
      <span>ğŸ“± ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ë©´ ë” í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”</span>
      <button type="button" class="btn btn-primary install-btn" id="installBtn">ì„¤ì¹˜</button>
    </div>
    <header>
      <div class="header-top">
        <h1>YouTube ë°±ê·¸ë¼ìš´ë“œ ì˜¤ë””ì˜¤</h1>
        <button type="button" class="btn-icon" id="settingsBtn" title="ì„¤ì •">âš™ï¸</button>
      </div>
      <div class="search-row">
        <input type="text" id="searchInput" placeholder="ìœ íŠœë¸Œ ê²€ìƒ‰ (ì œëª©, ê°€ìˆ˜ ë“±)" autocomplete="off" />
        <button type="button" class="btn btn-primary" id="searchBtn">ê²€ìƒ‰</button>
      </div>
      <p class="api-key-hint" id="apiKeyHintRow" style="display:none;"><button type="button" class="link-btn" id="openApiKeyBtn">ê²€ìƒ‰ ì‚¬ìš©: API í‚¤ ì„¤ì • (í•œ ë²ˆë§Œ ì…ë ¥)</button></p>
      <div class="search-results" id="searchResults"></div>
    </header>
    <main class="player-zone">
      <div id="yt-container"></div>
      <div class="now-playing" id="nowPlaying" style="display:none">
        <p class="title" id="videoTitle">â€”</p>
        <p class="id" id="videoId">â€”</p>
      </div>
      <div class="controls" id="controls" style="display:none">
        <button type="button" class="ctrl-btn" id="prevBtn" title="ì´ì „">â®</button>
        <button type="button" class="ctrl-btn play-pause" id="playPauseBtn" title="ì¬ìƒ/ì¼ì‹œì •ì§€">â–¶</button>
        <button type="button" class="ctrl-btn" id="nextBtn" title="ë‹¤ìŒ">â­</button>
      </div>
      <div class="progress-wrap" id="progressWrap" style="display:none">
        <div class="progress-bar" id="progressBar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="time-labels">
          <span id="currentTime">0:00</span>
          <span id="duration">0:00</span>
        </div>
      </div>
      <div class="volume-wrap" id="volumeWrap" style="display:none">
        <span style="font-size:18px">ğŸ”Š</span>
        <input type="range" id="volume" min="0" max="100" value="100" />
      </div>
    </main>
    <div class="mobile-card" id="mobileCard" style="display:none">
      <h3>ğŸ“± ëª¨ë°”ì¼ì—ì„œ ì ‘ì†</h3>
      <p>ê°™ì€ Wiâ€‘Fiì—ì„œ ì•„ë˜ ì£¼ì†Œë¡œ ì ‘ì†í•˜ê±°ë‚˜ QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì„¸ìš”.</p>
      <div class="mobile-url" id="mobileUrl"></div>
      <div class="qr-wrap"><img id="qrImg" src="" alt="QR" /></div>
    </div>
    <p class="hint">
      PC: ì°½ ìµœì†Œí™” ë˜ëŠ” ë‹¤ë¥¸ íƒ­ìœ¼ë¡œ ê°€ë„ ì†Œë¦¬ë§Œ ì¬ìƒë©ë‹ˆë‹¤.<br />
      ëª¨ë°”ì¼: <strong>ì•±ìœ¼ë¡œ ì„¤ì¹˜</strong>í•œ ë’¤ ì‹¤í–‰í•˜ë©´ í™”ë©´ì„ êº¼ë„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¬ìƒë©ë‹ˆë‹¤. ì ê¸ˆ í™”ë©´ì—ì„œ ì¬ìƒ/ì¼ì‹œì •ì§€ ê°€ëŠ¥.
    </p>
  </div>

  <div class="modal-overlay hidden" id="settingsModal">
    <div class="modal">
      <h3>ì„¤ì •</h3>
      <p id="settingsDesc">YouTube ê²€ìƒ‰ì„ ì‚¬ìš©í•˜ë ¤ë©´ Googleì—ì„œ ë°œê¸‰í•œ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. <strong>ë¬´ë£Œ</strong>ì´ë©°, í•˜ë£¨ ì•½ 100íšŒ ê²€ìƒ‰ê¹Œì§€ ë¬´ë£Œ í• ë‹¹ëŸ‰ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. (í•œ ë²ˆë§Œ ì…ë ¥)</p>
      <p class="modal-hint hidden" id="apiKeyRequiredHint">ì•„ë˜ì— API í‚¤ë¥¼ ì…ë ¥í•œ ë’¤ <strong>ì €ì¥</strong>ì„ ëˆ„ë¥´ë©´ ê²€ìƒ‰ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <input type="text" id="apiKeyInput" placeholder="YouTube Data API v3 í‚¤ (ì—¬ê¸°ì— ë¶™ì—¬ë„£ê¸°)" autocomplete="off" />
      <p style="font-size:11px; margin-top: -6px;">
        <a href="https://console.cloud.google.com/apis/library/youtube.googleapis.com" target="_blank" rel="noopener">Google Cloud Console</a>ì—ì„œ YouTube Data API v3 ì‚¬ìš© ì„¤ì • í›„ API í‚¤ ìƒì„±
      </p>
      <div class="btns">
        <button type="button" class="btn" id="settingsCloseBtn" style="background:var(--surface); color:var(--text);">ì·¨ì†Œ</button>
        <button type="button" class="btn btn-primary" id="settingsSaveBtn">ì €ì¥</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const nowPlaying = document.getElementById('nowPlaying');
      const videoTitle = document.getElementById('videoTitle');
      const videoIdEl = document.getElementById('videoId');
      const controls = document.getElementById('controls');
      const playPauseBtn = document.getElementById('playPauseBtn');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const progressWrap = document.getElementById('progressWrap');
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const currentTimeEl = document.getElementById('currentTime');
      const durationEl = document.getElementById('duration');
      const volumeInput = document.getElementById('volume');
      const volumeWrap = document.getElementById('volumeWrap');
      const searchInput = document.getElementById('searchInput');
      const searchBtn = document.getElementById('searchBtn');
      const searchResults = document.getElementById('searchResults');
      const API_KEY_STORAGE = 'yt_api_key';

      function getApiKey() { return localStorage.getItem(API_KEY_STORAGE) || ''; }
      function setApiKey(key) { localStorage.setItem(API_KEY_STORAGE, (key || '').trim()); }

      function parseVideoId(input) {
        const v = (input || '').trim();
        const m1 = v.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
        if (m1) return m1[1];
        if (/^[a-zA-Z0-9_-]{11}$/.test(v)) return v;
        return null;
      }

      function formatTime(s) {
        if (!s || isNaN(s)) return '0:00';
        const m = Math.floor(s / 60);
        const sec = Math.floor(s % 60);
        return m + ':' + (sec < 10 ? '0' : '') + sec;
      }

      let player = null;
      let pollTimer = null;

      function updateMediaSession(title, videoId) {
        if (!navigator.mediaSession) return;
        navigator.mediaSession.metadata = new MediaMetadata({
          title: title || 'YouTube',
          artist: 'YouTube',
          artwork: [{ src: 'https://i.ytimg.com/vi/' + videoId + '/mqdefault.jpg', sizes: '320x180', type: 'image/jpeg' }]
        });
        navigator.mediaSession.setActionHandler('play', () => player && player.playVideo());
        navigator.mediaSession.setActionHandler('pause', () => player && player.pauseVideo());
        navigator.mediaSession.setActionHandler('previoustrack', () => player && typeof player.previousVideo === 'function' && player.previousVideo());
        navigator.mediaSession.setActionHandler('nexttrack', () => player && typeof player.nextVideo === 'function' && player.nextVideo());
        navigator.mediaSession.setActionHandler('seekbackward', () => seekRelative(-10));
        navigator.mediaSession.setActionHandler('seekforward', () => seekRelative(10));
      }

      function seekRelative(sec) {
        if (!player) return;
        try {
          const t = player.getCurrentTime();
          player.seekTo(Math.max(0, t + sec), true);
        } catch (e) {}
      }

      function updateProgress() {
        if (!player) return;
        try {
          const state = player.getPlayerState();
          const current = player.getCurrentTime();
          const duration = player.getDuration();
          if (state === 1) {
            currentTimeEl.textContent = formatTime(current);
            const p = duration > 0 ? (current / duration) * 100 : 0;
            progressFill.style.width = p + '%';
          }
          if (duration && !isNaN(duration)) durationEl.textContent = formatTime(duration);
        } catch (e) {}
      }

      function startPolling() {
        if (pollTimer) clearInterval(pollTimer);
        pollTimer = setInterval(updateProgress, 500);
      }

      function stopPolling() {
        if (pollTimer) clearInterval(pollTimer);
        pollTimer = null;
      }

      function onPlayerReady(event) {
        player = event.target;
        try {
          player.setVolume(parseInt(volumeInput.value, 10));
        } catch (e) {}
        updateProgress();
        startPolling();
        if (navigator.mediaSession) {
          navigator.mediaSession.playbackState = 'playing';
        }
      }

      function onPlayerStateChange(event) {
        if (event.data === 1) {
          playPauseBtn.textContent = 'â¸';
          startPolling();
          if (navigator.mediaSession) navigator.mediaSession.playbackState = 'playing';
        } else if (event.data === 2 || event.data === 0) {
          playPauseBtn.textContent = 'â–¶';
          if (event.data === 0) stopPolling();
          if (navigator.mediaSession) navigator.mediaSession.playbackState = 'paused';
        }
        updateProgress();
      }

      function initPlayer(videoId) {
        if (player && player.destroy) player.destroy();
        stopPolling();
        const container = document.getElementById('yt-container');
        container.innerHTML = '';

        window.onYouTubeIframeAPIReady = function () {
          player = new YT.Player(container, {
            height: 200,
            width: 200,
            videoId: videoId,
            playerVars: {
              autoplay: 1,
              controls: 0,
              disablekb: 1,
              fs: 0,
              modestbranding: 1,
              playsinline: 1,
              rel: 0
            },
            events: {
              onReady: onPlayerReady,
              onStateChange: onPlayerStateChange
            }
          });
        };

        if (window.YT && window.YT.Player) {
          window.onYouTubeIframeAPIReady();
          return;
        }

        if (!document.querySelector('script[src*="youtube.com/iframe_api"]')) {
          const tag = document.createElement('script');
          tag.src = 'https://www.youtube.com/iframe_api';
          document.getElementsByTagName('script')[0].parentNode.insertBefore(tag, document.getElementsByTagName('script')[0]);
        }
      }

      function showPlayerUI(id, title) {
        nowPlaying.style.display = 'block';
        videoTitle.textContent = title || 'ì¬ìƒ ì¤‘';
        videoTitle.title = title || '';
        videoIdEl.textContent = id || '';
        controls.style.display = 'flex';
        progressWrap.style.display = 'block';
        volumeWrap.style.display = 'flex';
        updateMediaSession(title, id);
      }

      function loadVideoById(id, title) {
        initPlayer(id);
        showPlayerUI(id, title || 'ë¡œë”© ì¤‘â€¦');
        searchResults.innerHTML = '';
      }

      function openSettingsForApiKey() {
        apiKeyInput.value = getApiKey();
        var hint = document.getElementById('apiKeyRequiredHint');
        if (hint) hint.classList.remove('hidden');
        settingsModal.classList.remove('hidden');
        setTimeout(function () { apiKeyInput.focus(); }, 100);
      }
      function closeSettingsHint() {
        var hint = document.getElementById('apiKeyRequiredHint');
        if (hint) hint.classList.add('hidden');
      }
      function updateApiKeyHintVisibility() {
        var row = document.getElementById('apiKeyHintRow');
        if (row) row.style.display = getApiKey() ? 'none' : 'block';
      }
      updateApiKeyHintVisibility();

      searchBtn.addEventListener('click', function doSearch() {
        const q = (searchInput.value || '').trim();
        if (!q) { searchInput.focus(); return; }
        const apiKey = getApiKey();
        if (!apiKey) {
          openSettingsForApiKey();
          return;
        }
        searchResults.innerHTML = '<div class="search-loading">ê²€ìƒ‰ ì¤‘â€¦</div>';
        var url = 'https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=15&order=date&q=' + encodeURIComponent(q) + '&key=' + encodeURIComponent(apiKey);
        fetch(url)
          .then(function (r) { return r.json(); })
          .then(function (data) {
            searchResults.innerHTML = '';
            if (data.error) {
              searchResults.innerHTML = '<div class="search-error">' + (data.error.message || 'ê²€ìƒ‰ ì˜¤ë¥˜') + '</div>';
              return;
            }
            var items = data.items || [];
            if (items.length === 0) {
              searchResults.innerHTML = '<div class="search-loading">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
              return;
            }
            function formatDate(publishedAt) {
              if (!publishedAt) return '';
              var d = new Date(publishedAt);
              if (isNaN(d.getTime())) return '';
              var y = d.getFullYear();
              var m = String(d.getMonth() + 1).padStart(2, '0');
              var day = String(d.getDate()).padStart(2, '0');
              return y + '.' + m + '.' + day;
            }
            items.forEach(function (item) {
              var id = item.id && item.id.videoId;
              if (!id) return;
              var sn = item.snippet || {};
              var thumb = (sn.thumbnails && (sn.thumbnails.medium || sn.thumbnails.default)) || {};
              var dateStr = formatDate(sn.publishedAt);
              var dateLabel = dateStr ? ('ì—…ë¡œë“œ: ' + dateStr) : 'ì—…ë¡œë“œ: -';
              var div = document.createElement('div');
              div.className = 'search-item';
              div.innerHTML = '<img src="' + (thumb.url || '').replace(/"/g, '&quot;') + '" alt="" /><div class="info"><div class="stitle">' + (sn.title || '').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div><div class="channel">' + (sn.channelTitle || '').replace(/</g, '&lt;') + '</div><div class="date">' + dateLabel.replace(/</g, '&lt;') + '</div></div>';
              div.addEventListener('click', function () { loadVideoById(id, sn.title); });
              searchResults.appendChild(div);
            });
          })
          .catch(function (err) {
            searchResults.innerHTML = '<div class="search-error">ê²€ìƒ‰ ì‹¤íŒ¨. API í‚¤ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.</div>';
          });
      });
      searchInput.addEventListener('keydown', function (e) { if (e.key === 'Enter') searchBtn.click(); });

      var settingsModal = document.getElementById('settingsModal');
      var apiKeyInput = document.getElementById('apiKeyInput');
      document.getElementById('settingsBtn').addEventListener('click', function () {
        closeSettingsHint();
        apiKeyInput.value = getApiKey();
        settingsModal.classList.remove('hidden');
      });
      document.getElementById('openApiKeyBtn').addEventListener('click', openSettingsForApiKey);
      document.getElementById('settingsCloseBtn').addEventListener('click', function () { settingsModal.classList.add('hidden'); closeSettingsHint(); });
      document.getElementById('settingsSaveBtn').addEventListener('click', function () {
        setApiKey(apiKeyInput.value);
        settingsModal.classList.add('hidden');
        closeSettingsHint();
        updateApiKeyHintVisibility();
        var q = (searchInput.value || '').trim();
        if (q && getApiKey()) searchBtn.click();
      });
      settingsModal.addEventListener('click', function (e) { if (e.target === settingsModal) settingsModal.classList.add('hidden'); });

      var installBanner = document.getElementById('installBanner');
      var installBtn = document.getElementById('installBtn');
      var deferredPrompt = null;
      window.addEventListener('beforeinstallprompt', function (e) {
        e.preventDefault();
        deferredPrompt = e;
        if (installBanner && !window.matchMedia('(display-mode: standalone)').matches) installBanner.classList.add('show');
      });
      window.addEventListener('appinstalled', function () { deferredPrompt = null; if (installBanner) installBanner.classList.remove('show'); });
      if (installBtn) installBtn.addEventListener('click', function () {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(function (r) { if (r.outcome === 'accepted') deferredPrompt = null; });
      });
      if (window.matchMedia('(display-mode: standalone)').matches && installBanner) installBanner.classList.remove('show');

      playPauseBtn.addEventListener('click', function () {
        if (!player) return;
        try {
          const state = player.getPlayerState();
          if (state === 1) player.pauseVideo();
          else player.playVideo();
        } catch (e) {}
      });

      prevBtn.addEventListener('click', function () {
        if (player) try { player.previousVideo(); } catch (e) {}
      });

      nextBtn.addEventListener('click', function () {
        if (player) try { player.nextVideo(); } catch (e) {}
      });

      progressBar.addEventListener('click', function (e) {
        if (!player) return;
        const rect = progressBar.getBoundingClientRect();
        const p = (e.clientX - rect.left) / rect.width;
        try {
          const dur = player.getDuration();
          if (dur) player.seekTo(dur * p, true);
        } catch (err) {}
      });

      volumeInput.addEventListener('input', function () {
        const v = parseInt(this.value, 10);
        if (player) try { player.setVolume(v); } catch (e) {}
      });

      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').catch(function () {});
      }

      // ëª¨ë°”ì¼ ì ‘ì† ì•ˆë‚´ (PCì—ì„œ ì„œë²„ë¡œ ì ‘ì†í–ˆì„ ë•Œë§Œ í‘œì‹œ)
      fetch('/api/mobile-url').then(function (r) { return r.ok ? r.json() : null; }).then(function (data) {
        if (!data || !data.url) return;
        var card = document.getElementById('mobileCard');
        var urlEl = document.getElementById('mobileUrl');
        var qrImg = document.getElementById('qrImg');
        if (!card || !urlEl || !qrImg) return;
        urlEl.textContent = data.url;
        qrImg.src = 'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=' + encodeURIComponent(data.url);
        card.style.display = 'block';
      }).catch(function () {});
    })();
  </script>
</body>
</html>
